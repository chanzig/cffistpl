!function(o){var t=o.MyAjax,n=window.location.protocol;urlPrefix="https"==n.substr(0,5)?"https://"+window.location.host+"/":"http://"+window.location.host+"/";var a={dev:"http://10.1.20.24:8080/",qa:"http://10.1.20.32:8081/",qa1:"http://qa1-api.liancheinfo.net/",qa3:"http://qa3-api.liancheinfo.net:8081/",localhost:"http://localhost:8080/chainlife-front/"},i=!0,r=i?"jsonp":"json",e=i?"GET":"POST";urlPrefix=i?a.qa3:urlPrefix,ajaxConfig={type:e,dataType:r,cache:!1,jsonp:"jsoncallback"};var c={urlAddress:urlPrefix,url:{productGroupList:"product/getList.json"},send:function(o){return o.config.url=urlPrefix+o.config.url,ajaxConfig.success=function(t){0==t.code?o.success&&o.success(t.data,t.total):3e3==t.code?o.unLogin&&o.unLogin():o.failure&&o.failure(t.msg)},ajaxConfig.error=function(){o.error&&o.error("服务器开小差了")},ajaxConfig.complete=function(){o.complete&&o.complete()},$.ajax($.extend(o.config,ajaxConfig))}};c.noConflict=function(){return o.MyAjax=t,c},o.MyAjax=c}(this);
var CARUTILS=function(){var e={getParameter:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},parseMobile:function(e){return null!=e?e.substr(0,3)+"****"+e.substr(7,11):null},investUserName:function(e){if(null!=e){if(2==e.length)return e.substr(0,1)+"*";if(3==e.length)return e.substr(0,1)+"**";if(4==e.length)return e.substr(0,2)+"**";if(e.length>4)return e.substr(0,2)+"****"}return null},UrlPath:{set:function(e){window.location.href=e.indexOf("?")>-1?e+"&returnurl="+encodeURI(window.location.pathname+window.location.search):e+"?returnurl="+encodeURI(window.location.pathname+window.location.search)},locationhref:function(e){var t=window.location.href,n=t.indexOf("returnurl");if(t.indexOf("returnurl")>-1){var r=t.substring(n),l=new RegExp("(^|&)returnurl=([^&]*)(&|$)","i"),u=r.match(l);url=null!=u?unescape(u[2]):null}else url=null;window.location.href=null==url?e:decodeURI(url)}},fmtDate:function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},addComma:function(e){e+="";var t,n,r,l="";t=e.replace(/,/g,"").split("."),n=t[0].length%3,r=t[0].substr(n).toString();for(var u=0;u<r.length;u++)l=u%3==0?l+","+r.substr(u,1):l+r.substr(u,1);var s=void 0==t[1]?t[0].substr(0,n)+l:t[0].substr(0,n)+l+"."+t[1];return 44==s.charCodeAt(0)&&(s=s.substr(1)),s},removeComma:function(e){e+="";var t;return t=e.replace(/,/g,""),Number(t)},showMoney:function(e){var e=e+"",t=e.split(".")[0],n="";if(t.length>3){for(;t.length>3;)n=""==n?t.substr(t.length-3,t.length):t.substr(t.length-3,t.length)+","+n,t=t.substr(0,t.length-3);(null!=t||""!=t)&&(n=t+","+n)}else n=t;return e.split(".")[1]&&null!=e.split(".")[1]?n=n+"."+e.split(".")[1]:n+=".00",n}};return e}();
var VALIDATEUTIL=function(){var r={nameReg:/^([\u4e00-\u9fa5]{1,20}|[a-zA-Z\.\s]{1,20})$/,certiCodeReg:/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,mobileReg:/^1\d{10}$/,companyMobileReg:/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{6,14}$/,loginPwdReg:/^[0-9A-Za-z]{6,20}$/,payPwdReg:/^\d{6}$/,email:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,isNotEmpty:function(r,s,o){var e=this;return r&&null!=r&&""!=r?(e.hideErrorMsg(""),!0):(o&&e.showErrorMsg(s+"不能为空"),!1)},certiCode:function(r,s){var o=this,e=o.certiCodeReg;return 0==e.test(r)?(s&&o.showErrorMsg("请输入有效的身份证信息"),!1):(o.hideErrorMsg(""),!0)},mobile:function(r,s){var o=this,e=o.mobileReg;return e.test(r)?(o.hideErrorMsg(""),!0):(s&&o.showErrorMsg("请确认你的手机号码"),!1)},loginPassword:function(r,s){var o=this,e=o.loginPwdReg;return e.test(r)?(o.hideErrorMsg(""),!0):(s&&o.showErrorMsg("请输入6-20位数字或字母"),!1)},payPassword:function(r,s){var o=this,e=o.payPwdReg;return e.test(r)?(o.hideErrorMsg(""),!0):(s&&o.showErrorMsgs("请输入6位数字交易密码"),!1)},againPassword:function(r,s,o){var e=this;return r!=s?(o&&e.showErrorMsg("确认密码错误"),!1):(e.hideErrorMsg(""),!0)},checkData:function(){return!0},isSelect:function(){var r=this,s=$(".virtualRight").hasClass("dispaly");return s?(r.showErrorMsg("未同意协议"),!1):(r.hideErrorMsg(""),!0)},isEmail:function(r,s){var o=this,e=o.email;return e.test(r)?(o.hideErrorMsg(""),!0):(s&&o.showErrorMsg("请输入正确的邮箱信息！"),!1)},isEmptyANum:function(r,s,o){var e=this;return r&&null!=r&&""!=r?isNaN(r)?(o&&e.showErrorMsg(s+"不能包含非数字"),!1):(e.hideErrorMsg(""),!0):(o&&e.showErrorMsg(s+"不能为空"),!1)},showCN:function(r){return r&&null!=r&&""!=r?r.substr(0,2)+"*****":""},showErrorMsg:function(r){var s=this;$(".error2").is(":visible")&&s.hideErrorMsg(),$(".error2").removeClass("hide"),$(".error2").animate({top:"0px"},"slow",function(){}),$(".error2 span").text(r),s.autoHideErrorMsg()},autoHideErrorMsg:function(){var r=this;$(".error2").is(":visible")&&setTimeout(function(){r.hideErrorMsg()},4e3)},hideErrorMsg:function(){$(".error2").addClass("hide"),$(".error2 span").text("")}};return r}();
"use strict";$(function(){var t={init:function(){var t=this;t.minInvest=1e3,t.minAdd=10,t.priceOpreation(),t.productId="",t.protime="",t.PRODUCTS="",t.getMerInfo(),t.merChange(),t.proChange(),t.timeChange(),t.submit()},getMerInfo:function(){var t="";MyAjax.send({config:{url:"product/merInfo.json",data:{productType:2}},success:function(n){n&&(n.forEach(function(n){t+='<option value="'+n.id+'">'+n.merchantName+"</option>"}),$("#insuranceCompany").append(t))}})},merChange:function(){var t=this;$("#insuranceCompany").change(function(){var n=$(this).find("option:selected").val();n?($("#productName option").not(":first").remove(),$("#time option").not(":first").remove(),t.getProduct(n)):($("#productName option").not(":first").remove(),$("#time option").not(":first").remove())})},proChange:function(){var t=this;$("#productName").change(function(){t.productId=$(this).find("option:selected").val(),t.productId?t.gerProductTime():$("#time option").not(":first").remove()})},timeChange:function(){var t=this;$("#time").change(function(){if(t.protime=$(this).find("option:selected").val(),t.protime){var n=_.findWhere(t.PRODUCTS,{id:parseInt(t.productId)}),o=_.findWhere(n.productCycle,{id:parseInt(t.protime)});o&&$(".showrate").val(o.rate+"%")}})},gerProductTime:function(){var t=this,n="",o=_.findWhere(t.PRODUCTS,{id:parseInt(t.productId)});o.productCycle&&(o.productCycle.forEach(function(t){n+='<option value="'+t.id+'">'+t.cycle+"期</option>"}),$("#time").append(n))},getProduct:function(t){var n=this,o="";MyAjax.send({config:{url:"product/all.json",data:{merId:t}},success:function(t){console.log(t),t&&(n.PRODUCTS=t,t.forEach(function(t){o+='<option value="'+t.id+'">'+t.name+"</option>"}),$("#productName").append(o))}}),$("#time").change(function(){n.protime=$(this).find("option:selected").val()})},submit:function(){var t=this;$(".submitdiv button").click(function(){var n=this;return t.varlidate()?($(n).prop("disabled",!0),void MyAjax.send({config:{url:"order/submit.json",data:{userId:t.userId,productId:t.productId,productCycleId:t.protime,amount:$("#carPrice").val()}},success:function(t){"{status:1}"==t?CARUTILS.UrlPath.set("/pages/user/veriyInfo.html"):location.href="/pages/order/orderdetail.html?orderid="+t},unLogin:function(){CARUTILS.UrlPath.set("/pages/user/login.html")},error:function(t){VALIDATEUTIL.showErrorMsg(t)},failure:function(t){VALIDATEUTIL.showErrorMsg(t)},complete:function(){$(n).prop("disabled",!1)}})):!1})},varlidate:function(){var t=this;t.userId=window.localStorage.getItem("carcfuid");var n=$("#insuranceCompany option:selected").val(),o=$("#productName option:selected").val(),e=$("#time option:selected").val(),i=$("#carPrice").val();return n?o?e?i?!0:(VALIDATEUTIL.showErrorMsg("请输入车险价格"),!1):(VALIDATEUTIL.showErrorMsg("请选择分期期数"),!1):(VALIDATEUTIL.showErrorMsg("请选择产品"),!1):(VALIDATEUTIL.showErrorMsg("请选择保险公司"),!1)},priceOpreation:function(){var t=this,n=$(".inputGroup input");$(".plus").click(function(){var o=$(".inputGroup input").val();o=parseInt(o)+t.minAdd,n.val(o)}),$(".minus").click(function(){var o=$(".inputGroup input").val();o>t.minInvest&&(o=parseInt(o)-t.minAdd,n.val(o))}),n.blur(function(){var o=$(".inputGroup input").val();return!/^-?[1-9]\d*$/.test(o)||o<t.minInvest?(n.val(t.minInvest),void(o=t.minInvest)):void 0})}};t.init()});
